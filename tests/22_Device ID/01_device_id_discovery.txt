*** Settings ***
Resource   	Device_ID_imports.txt
Force Tags           DEVICE_ID    BATCH3	 

*** variables ***
 ${app_id_01}					10074
 ${web_id_01}					13194
 
*** Test Cases ***
# https://jira.adhaven.com/browse/ADH-6249

Mopub Mobile Request With Hashed ID, Without Unhashed ID (may served)
	#if the setting in rhino.system_settings.use.hased.dvice.ids = true (ad will serve, else ad will not serve
	   ${random_device_id}=		Generate Clear Device ID         	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO
	   
Mopub Mobile Request With IP, Without Hashed ID, Without Unhashed ID (not served)
	#we will not serve mobile app if it has IP only (we used to but not anymore).
	   ${random_device_id}=		Generate Clear Device ID         	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   

#8.9 We start to reject all request that does not have hash ID.
Mopub Invalid Hashed ID, Longer Than 36 Char (not served)
	   ${random_device_id}=		Generate Clear Device ID         	  
	   Set Test Variable 	${random_device_id} 		${random_device_id}1
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   Run Keyword If 			'${HASHED_ID}'=='OFF'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   
	   Run Keyword If 			'${HASHED_ID}'=='ON'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO
	   
Mopub Invalid Hashed ID, Shorter Than 36 Char (not served)
	   ${random_device_id}=		Generate Clear Device ID	
	   ${random_device_id}=		Remove String Using Regexp		${random_device_id}		\\d         	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   Run Keyword If 			'${HASHED_ID}'=='OFF'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   
	   Run Keyword If 			'${HASHED_ID}'=='ON'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO

Mopub Invalid Hashed ID, Invalid Char Z (not served)
	   ${random_device_id}=		Generate Clear Device ID	
	   ${random_device_id}=		Replace String Using Regexp		${random_device_id}		\\d		Z         	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   Run Keyword If 			'${HASHED_ID}'=='OFF'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   
	   Run Keyword If 			'${HASHED_ID}'=='ON'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO
	[Tags]	Exclude
Mopub Invalid Hashed ID, 36char without dash (not served)
	   ${random_device_id}=         Generate Random String 		36		ABCDEF0123456789	  	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   Run Keyword If 			'${HASHED_ID}'=='OFF'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   
	   Run Keyword If 			'${HASHED_ID}'=='ON'			RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO

Mopub Valid Hashed ID, 32char without dash (served)
	   ${random_device_id}=         Generate Random String 		32		ABCDEF0123456789	  	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO   

Mopub Valid Hashed ID, 36 char and with dashes (served)
	   ${random_device_id}=         Generate Clear Device ID	  	  
	   Set Test Variable    ${data}   	{"app":{"bundle":"xxcom.myyearbook.m","cat":["IAB24","social_networking"],"id":"${app_id_01}","name":"MeetMe_Android","publisher":{"id":"87e493a6b4424a6eb0ab7bc187d4345d","name":"Beanstock Media Inc."},"ver":"10.0"},"at":2,"badv":["landrover","landrover.com","landrovertristate.com","pof.com","rangerover.com","skout.com","zoosk.com"],"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"ifa":"${random_device_id}","geo":{"city":"Norwalk","country":"USA","lat":41.250885,"lon":-82.612862,"region":"OH","zip":"44857"},"ip":"174.100.132.64","js":1,"make":"samsung","model":"SPH-L720","os":"Android","osv":"4.4.2","ua":"Mozilla/5.0 (Linux; Android 4.4.2; SPH-L720 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36"},"id":"b193650a-525c-4655-b6cb-1543028a4565","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.030,"displaymanager":"mopub","displaymanagerver":"3.4.0+kit","id":"1","instl":0,"tagid":"5b5991da24da4b68be268c0bc1e9eb2d"}],"user":{"keywords":"DEV_TYPE:jfltespr,BUILD_TYPE:release,DEV_MODEL:SPH-L720,DEV_MFR:samsung,AGE:20,GENDER:m,DEV_BRAND:samsung"}}	  
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO   

Mopub Web With Clear Device ID (served)
	   ${random_device_id}=         Generate Clear Device ID	  	  
	   Set Test Variable    ${data}   	{"at":2,"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"dpidmd5":"1b640600fbdb4776295569bded495f75","dpidsha1":"5d8b97b93c3b7351f7821bbd23a7336b0bf228f2","ifa":"2d75e05a-f74c-428e-bebd-f74121d90277","geo":{"city":"Fort Worth","country":"USA","lat":32.578361,"lon":-97.147758,"metro":"623","region":"TX","zip":"76140"},"ip":"66.169.179.107","js":1,"make":"samsung","model":"SM-G920P","os":"Android","osv":"5.1.1","ua":"Mozilla/5.0 (Linux; Android 5.1.1; SM-G920P Build/LMY47X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/46.0.2490.76 Mobile Safari/537.36"},"id":"34971c6c-caac-4e69-a1c1-a9c83e468c84","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.0160,"displaymanager":"mopub","displaymanagerver":"3.4.0","ext":{"secure":0},"id":"1","instl":0,"tagid":"agltb3B1Yi1pbmNyDQsSBFNpdGUYitrvEww"}],"site":{"cat":["IAB1","IAB14","entertainment","lifestyle"],"id":"${web_id_01}","name":"KiddNation","publisher":{"id":"agltb3B1Yi1pbmNyEAsSB0FjY291bnQYm4upEww","name":"Yea Networks"}}}
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO   

Mopub Web Without Clear Device ID, With IP (served) 
	   Set Test Variable    ${data}   	{"at":2,"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"geo":{"city":"Fort Worth","country":"USA","lat":32.578361,"lon":-97.147758,"metro":"623","region":"TX","zip":"76140"},"ip":"66.169.179.107","js":1,"make":"samsung","model":"SM-G920P","os":"Android","osv":"5.1.1","ua":"Mozilla/5.0 (Linux; Android 5.1.1; SM-G920P Build/LMY47X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/46.0.2490.76 Mobile Safari/537.36"},"id":"34971c6c-caac-4e69-a1c1-a9c83e468c84","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.0160,"displaymanager":"mopub","displaymanagerver":"3.4.0","ext":{"secure":0},"id":"1","instl":0,"tagid":"agltb3B1Yi1pbmNyDQsSBFNpdGUYitrvEww"}],"site":{"cat":["IAB1","IAB14","entertainment","lifestyle"],"id":"${web_id_01}","name":"KiddNation","publisher":{"id":"agltb3B1Yi1pbmNyEAsSB0FjY291bnQYm4upEww","name":"Yea Networks"}}}
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=200        submit_client_impression_event=NO   

Mopub Web Without Device ID, Without IP (not served)
	   Set Test Variable    ${data}   	{"at":2,"bcat":["IAB25","IAB26","IAB3-7"],"device":{"carrier":"310-120","connectiontype":2,"devicetype":1,"dnt":0,"geo":{"city":"Fort Worth","country":"USA","lat":32.578361,"lon":-97.147758,"metro":"623","region":"TX","zip":"76140"},"js":1,"make":"samsung","model":"SM-G920P","os":"Android","osv":"5.1.1","ua":"Mozilla/5.0 (Linux; Android 5.1.1; SM-G920P Build/LMY47X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/46.0.2490.76 Mobile Safari/537.36"},"id":"34971c6c-caac-4e69-a1c1-a9c83e468c84","imp":[{"banner":{"api":[3,5],"battr":[3,8,10,14,6],"btype":[4],"ext":{"nativebrowserclick":1},"h":50,"pos":1,"w":320},"bidfloor":0.0160,"displaymanager":"mopub","displaymanagerver":"3.4.0","ext":{"secure":0},"id":"1","instl":0,"tagid":"agltb3B1Yi1pbmNyDQsSBFNpdGUYitrvEww"}],"site":{"cat":["IAB1","IAB14","entertainment","lifestyle"],"id":"${web_id_01}","name":"KiddNation","publisher":{"id":"agltb3B1Yi1pbmNyEAsSB0FjY291bnQYm4upEww","name":"Yea Networks"}}}
	   RTB Request 				API=${RTB_MOPUB_API}          data=${data}		response_code=204        submit_client_impression_event=NO   
   