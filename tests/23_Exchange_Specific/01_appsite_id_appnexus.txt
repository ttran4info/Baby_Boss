*** Settings ***
Resource             exchange_specific_imports.txt
Force Tags           APPSITEID    BATCH3	APPNEXUS 	
Suite Teardown      Close All Connections

*** variables ***
${app_id}					13189
${site_id}					13192
 
*** Test Cases ***
# Appnexus does not have app ID or site ID. it will use the name lowercase, md5
#AppNexus Exchange: Millennial Media (selling_mbmer_id:2066)
#AppNexus Exchange: Microsoft Advertising Exchange (selling_mbmer_id:280)
Appnexus Millennial- Logging app ID as ID
	   ${device_id}=		Generate Clear Device ID
	    Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-06-0400:48:07","bidder_timeout_ms":100,"members":[{"id":2049}],"member_ad_profile_id":198147,"excluded_categories":[13,17,29,38,39,60,78,80,116,118],"excluded_technical_attributes":[33],"tags":[{"auction_id_64":3680263782502,"size":"300x250","sizes":["300x250"],"smaller_sizes_allowed":false,"position":"unknown","tag_format":"iframe","supply_type":"mobile_app","site_id":886154,"ad_profile_id":251049,"visibility_profile_id":990,"venue_id":744119,"inventory_source_id":1719,"allowed_media_types":[1],"media_subtypes":["banner"],"estimated_clear_price":0.248,"estimated_average_price":0.081,"id":3620009,"inventory_audits":[{"auditor_member_id":2066,"content_categories":[10,13]}]}],"bid_info":{"user_id_64":6254650908374539000,"no_cookies":false,"payment_rule_id":507442,"no_flash":false,"certified_supply":true,"user_agent":"Mozilla/5.0(iPad;CPUOS8_1_1likeMacOSX)AppleWebKit/600.1.4(KHTML,likeGecko)Mobile/12B435","browser":0,"operating_system":10,"operating_system_extended":129,"operating_system_family":3,"carrier":1,"device_make":26,"device_model":300,"device_type":3,"session_freq":1,"pub_session_freq":1,"ip_address":"76.30.108.22","country":"US","region":"TX","city":"SugarLand","postal_code":"77479","dma":618,"time_zone":"America/Chicago","inventory_class":"class_3","within_iframe":false,"device_ids":{"idfa":"${device_id}","sha1udid":"a9dea295df1cdb430706204134814a4c16bd9d99","md5udid":"52a2ffd2f1210a377d4365bbb816f386"},"selling_member_id":2066,"publisher_id":442520,"app_id":"${app_id}","mobile_app_instance_id":685,"inventory_audits":[{"auditor_member_id":null,"inventory_attributes":[]}],"userdata_json":"{}","segments":[{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23118867}]}}}	   
		Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id":"1234534625254","at":2,"tmax":120,"imp":[{"id":"1","banner":{"w":320,"h":50,"pos":1,"battr":[13]}}],"badv":["company1.com","company2.com"],"app":{"id":"${app_id}","bundle":"com.rovio.angrybirds","cat":["IAB2-1","IAB2-2"],"publisher":{"id":"pub12345"}},"device":{"ifa":"${random_device_id}","ip":"64.124.253.1","ua":"Mozilla/5.0(Macintosh;U;IntelMacOSX10.6;en-US;rv:1.9.2.16)Gecko/20110319Firefox/3.6.16","os":"OSX"},"ext":{"appnexus":{"seller_member_id":2066,"spend_protection":true}},"user":{"id":"45asdf987656789adfad4678rew656789"}}   
	   	   
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=${app_id}
	   Should Match Regexp 			${output}  				55=
	   [Tags]		Exclude
#skip App nexus does not have app name or site name, so we are not going to test name replacing ID.	   

#when both ID and Name is missing from request
# AppNexus Exchange: Millennial Media: not available -> md5 = db37d8d1ef5383ac54a193277ed9539a
# AppNexus: Millennial Media: not available ->md5 = 608c522b1ebd7df896fd98e27f65ed5b
# AppNexus Exchange: not available -> md5 = f4d4108bc0a6ff8633fe88f671136eb8
Appnexus Millennial- Logging (exchange:not available) as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-06-0400:48:07","bidder_timeout_ms":100,"members":[{"id":2049}],"member_ad_profile_id":198147,"excluded_categories":[13,17,29,38,39,60,78,80,116,118],"excluded_technical_attributes":[33],"tags":[{"auction_id_64":3680263782502,"size":"300x250","sizes":["300x250"],"smaller_sizes_allowed":false,"position":"unknown","tag_format":"iframe","supply_type":"mobile_app","site_id":886154,"ad_profile_id":251049,"visibility_profile_id":990,"venue_id":744119,"inventory_source_id":1719,"allowed_media_types":[1],"media_subtypes":["banner"],"estimated_clear_price":0.248,"estimated_average_price":0.081,"id":3620009,"inventory_audits":[{"auditor_member_id":2066,"content_categories":[10,13]}]}],"bid_info":{"user_id_64":6254650908374539000,"no_cookies":false,"payment_rule_id":507442,"no_flash":false,"certified_supply":true,"user_agent":"Mozilla/5.0(iPad;CPUOS8_1_1likeMacOSX)AppleWebKit/600.1.4(KHTML,likeGecko)Mobile/12B435","browser":0,"operating_system":10,"operating_system_extended":129,"operating_system_family":3,"carrier":1,"device_make":26,"device_model":300,"device_type":3,"session_freq":1,"pub_session_freq":1,"ip_address":"76.30.108.22","country":"US","region":"TX","city":"SugarLand","postal_code":"77479","dma":618,"time_zone":"America/Chicago","inventory_class":"class_3","within_iframe":false,"device_ids":{"idfa":"${device_id}","sha1udid":"a9dea295df1cdb430706204134814a4c16bd9d99","md5udid":"52a2ffd2f1210a377d4365bbb816f386"},"selling_member_id":2066,"publisher_id":442520,"mobile_app_instance_id":685,"inventory_audits":[{"auditor_member_id":null,"inventory_attributes":[]}],"userdata_json":"{}","segments":[{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23118867}]}}}	   
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id":"1234534625254","at":2,"tmax":120,"imp":[{"id":"1","banner":{"w":320,"h":50,"pos":1,"battr":[13]}}],"badv":["company1.com","company2.com"],"app":{"bundle":"com.rovio.angrybirds","cat":["IAB2-1","IAB2-2"],"publisher":{"id":"pub12345"}},"device":{"ifa":"${random_device_id}","ip":"64.124.253.1","ua":"Mozilla/5.0(Macintosh;U;IntelMacOSX10.6;en-US;rv:1.9.2.16)Gecko/20110319Firefox/3.6.16","os":"OSX"},"ext":{"appnexus":{"seller_member_id":2066,"spend_protection":true}},"user":{"id":"45asdf987656789adfad4678rew656789"}}      
	    
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}
	   Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=f4d4108bc0a6ff8633fe88f671136eb8
	   Should Match Regexp 			${output}  				55=
	[Tags]		Exclude
Appnexus Millennial- Logging SITE ID as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-06-0400:48:07","bidder_timeout_ms":100,"members":[{"id":2049}],"member_ad_profile_id":198147,"excluded_categories":[13,17,29,38,39,60,78,80,116,118],"excluded_technical_attributes":[33],"tags":[{"auction_id_64":3680263782502,"size":"300x250","sizes":["300x250"],"smaller_sizes_allowed":false,"position":"unknown","tag_format":"iframe","supply_type":"mobile_web","site_id":654321,"ad_profile_id":251049,"visibility_profile_id":990,"venue_id":744119,"inventory_source_id":1719,"allowed_media_types":[1],"media_subtypes":["banner"],"estimated_clear_price":0.248,"estimated_average_price":0.081,"id":3620009,"inventory_audits":[{"auditor_member_id":2066,"content_categories":[10,13]}]}],"bid_info":{"user_id_64":6254650908374539000,"no_cookies":false,"payment_rule_id":507442,"no_flash":false,"certified_supply":true,"user_agent":"Mozilla/5.0(iPad;CPUOS8_1_1likeMacOSX)AppleWebKit/600.1.4(KHTML,likeGecko)Mobile/12B435","browser":0,"operating_system":10,"operating_system_extended":129,"operating_system_family":3,"carrier":1,"device_make":26,"device_model":300,"device_type":3,"session_freq":1,"pub_session_freq":1,"ip_address":"76.30.108.22","country":"US","region":"TX","city":"SugarLand","postal_code":"77479","dma":618,"time_zone":"America/Chicago","inventory_class":"class_3","within_iframe":false,"device_ids":{"idfa":"${device_id}","sha1udid":"a9dea295df1cdb430706204134814a4c16bd9d99","md5udid":"52a2ffd2f1210a377d4365bbb816f386"},"selling_member_id":2066,"publisher_id":442520,"app_id":"123456","mobile_app_instance_id":685,"inventory_audits":[{"auditor_member_id":null,"inventory_attributes":[]}],"userdata_json":"{}","segments":[{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23118867}]}}}	   
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id":"1234534625254","at":2,"tmax":120,"imp":[{"id":"1","banner":{"w":320,"h":50,"pos":1,"battr":[13]}}],"badv":["company1.com","company2.com"],"app":{"bundle":"com.rovio.angrybirds","cat":["IAB2-1","IAB2-2"],"publisher":{"id":"pub12345"}},"device":{"ifa":"${random_device_id}","ip":"64.124.253.1","ua":"Mozilla/5.0(Macintosh;U;IntelMacOSX10.6;en-US;rv:1.9.2.16)Gecko/20110319Firefox/3.6.16","os":"OSX"},"ext":{"appnexus":{"seller_member_id":2066,"spend_protection":true}},"user":{"id":"45asdf987656789adfad4678rew656789"}}      
	   #This data variable may need modifying
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=
	   Should Match Regexp 			${output}  				55=654321  
	   [Tags]		Exclude
Appnexus Millennial- Logging SITE (exchange:not available) as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-06-0400:48:07","bidder_timeout_ms":100,"members":[{"id":2049}],"member_ad_profile_id":198147,"excluded_categories":[13,17,29,38,39,60,78,80,116,118],"excluded_technical_attributes":[33],"tags":[{"auction_id_64":3680263782502,"size":"300x250","sizes":["300x250"],"smaller_sizes_allowed":false,"position":"unknown","tag_format":"iframe","supply_type":"mobile_web","ad_profile_id":251049,"visibility_profile_id":990,"venue_id":744119,"inventory_source_id":1719,"allowed_media_types":[1],"media_subtypes":["banner"],"estimated_clear_price":0.248,"estimated_average_price":0.081,"id":3620009,"inventory_audits":[{"auditor_member_id":2066,"content_categories":[10,13]}]}],"bid_info":{"user_id_64":6254650908374539000,"no_cookies":false,"payment_rule_id":507442,"no_flash":false,"certified_supply":true,"user_agent":"Mozilla/5.0(iPad;CPUOS8_1_1likeMacOSX)AppleWebKit/600.1.4(KHTML,likeGecko)Mobile/12B435","browser":0,"operating_system":10,"operating_system_extended":129,"operating_system_family":3,"carrier":1,"device_make":26,"device_model":300,"device_type":3,"session_freq":1,"pub_session_freq":1,"ip_address":"76.30.108.22","country":"US","region":"TX","city":"SugarLand","postal_code":"77479","dma":618,"time_zone":"America/Chicago","inventory_class":"class_3","within_iframe":false,"device_ids":{"idfa":"${device_id}","sha1udid":"a9dea295df1cdb430706204134814a4c16bd9d99","md5udid":"52a2ffd2f1210a377d4365bbb816f386"},"selling_member_id":2066,"publisher_id":442520,"app_id":"123456","mobile_app_instance_id":685,"inventory_audits":[{"auditor_member_id":null,"inventory_attributes":[]}],"userdata_json":"{}","segments":[{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23118867}]}}}	   
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id":"1234534625254","at":2,"tmax":120,"imp":[{"id":"1","banner":{"w":320,"h":50,"pos":1,"battr":[13]}}],"badv":["company1.com","company2.com"],"site":{"idx":"${site_id}","bundle":"com.rovio.angrybirds","cat":["IAB2-1","IAB2-2"],"publisher":{"id":"pub12345"}},"device":{"ip":"64.124.253.1","ua":"Mozilla/5.0(Macintosh;U;IntelMacOSX10.6;en-US;rv:1.9.2.16)Gecko/20110319Firefox/3.6.16","os":"OSX"},"ext":{"appnexus":{"seller_member_id":280,"spend_protection":true}},"user":{"id":"45asdf987656789adfad4678rew656789"}}
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=
	   Should Match Regexp 			${output}  				55=f4d4108bc0a6ff8633fe88f671136eb8 	   
	[Tags]		Exclude
##########################################
Appnexus Microsoft- Logging app ID as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-09-16 23:56:02","bidder_timeout_ms":350,"members": [{"id":2049}],"member_ad_profile_id":23349,"excluded_technical_attributes":[2,36],"tags": [{"auction_id_64": 168244946211,"size": "300x250","sizes" : ["300x250"],"smaller_sizes_allowed": false,"position": "unknown","tag_format": "iframe","supply_type": "mobile_app","site_id": 853842,"creative_formats_map": "111111111111","creative_formats": ["unknown","html-url","js-url","flash","image","js-raw","html-raw","html-iframe","vast-url","text","xml-url","file-url"],"ad_profile_id": 535543,"visibility_profile_id": 1265,"venue_id": 747342,"pop_max_width": 300,"pop_max_height": 250,"pop_is_prepop": false,"allowed_media_types": [1],"media_subtypes": ["banner"],"estimated_clear_price":0.19000,"estimated_average_price":0.0480,"id":3500613}],"bid_info": {"user_id_64": 8286532254374716388,"no_cookies": false,"payment_rule_id": 483070,"no_flash": true,"user_agent": "WindowsAdClient/8.1.30911.0 (Windows; XAML)","browser": 0,"operating_system_extended": 93,"operating_system_family": 5,"carrier": 1,"device_type": 1,"language": 1,"session_freq": 1,"pub_session_freq": 1,"ip_address": "75.129.210.209","country": "US","region": "MI","city": "Big Rapids","postal_code": "49307","dma": 540,"time_zone": "America/New_York","inventory_class": "unaudited","within_iframe": false,"device_ids": {"windowsadid": "${device_id}"},"selling_member_id":280,"publisher_id":421220,"gender":"female","app_id":"${app_id}","url":"windows.xbox_apps_windows.games.microsoftadexchange.com","domain":"windows.xbox_apps_windows.games.microsoftadexchange.com","userdata_json":"{}","segments": [{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":24039426}]}}} 	   
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id": "8765482113786061111","imp": [{"id": "449387476987463500","banner": {"w": 320,"h": 50,"id": "1","battr": [1, 2, 15],"pos": 0,"format": [{"w": 320,"h": 50}]},"instl": 0,"tagid": "12347654","secure": 1,"ext": {"appnexus": {"estimated_clear_price": 0.57,"predicted_view_rate": 0.073255,"member_ad_profile_id": 1111055,"predicted_video_completion_rate": 0.592172,"predicted_view_rate_over_total": 0.067229,"allowed_payment_types": [{"payment_type": 1,"imp_count_method": 2}]}}}],"app": {"id": "${app_id}","domain": "example.com","cat": ["IAB12-2", "IAB12", "IAB11-5"],"page": "https://example.com/somepage.html","publisher": {"id": "1111999"}},"device": {"ua": "Mozilla/5.0 (Linux; Android 6.0.1; HUAWEI Build/MMB28B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.137 Mobile Safari/537.36","geo": {"lat": 36.6203,"lon": -4.4998,"country": "US","region": "MA","metro": "1","city": "UnaCuidad","zip": "94110","utcoffset": 60,"ext": {"appnexus": {"timezone": "Africa/Ceuta"}}},"dnt": 0,"ip": "11.222.111.0","devicetype": 3,"ifa": "${device_id}","make": "Unknown","model": "Generic Android Mobile","os": "Android","language": "es","connectiontype": 0},"user": {"id": "7939999668795769876","buyeruid": "CABBBBrbuQ9AA5DMJJJJlOL9ZOo","gender": "O","data": [{"id": "0","segment": [{"id": "1","value": "0"}]}, {"id": "1234","segment": [{"id": "4444555","value": "0"}]}]},"test": 0,"at": 1,"tmax": 150,"wseat": ["1234"],"cur": ["USD"],"bcat": ["IAB23-7", "IAB23-5", "IAB23-10", "IAB23-9", "IAB23-1", "IAB7-44", "IAB9-9", "IAB8-18", "IAB8-5"],"badv": ["url1.com", "url2.com"],"ext": {"appnexus": {"seller_member_id": 123,"spend_protection": true,"publisher_integration": {"is_header": 0,"bid_shading_high": 1,"bid_shading_medium": 0.35,"bid_shading_low": 0.95}}},"source": {"fd": 1,"tid": "2dd111ff-7777-4abc-8558-86a123ab46d6"}}	
     
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=${app_id}
	   Should Match Regexp 			${output}  				55=

Appnexus Microsoft- Logging (exchange:not available) as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-09-16 23:56:02","bidder_timeout_ms":350,"members": [{"id":2049}],"member_ad_profile_id":23349,"excluded_technical_attributes":[2,36],"tags": [{"auction_id_64": 168244946211,"size": "300x250","sizes" : ["300x250"],"smaller_sizes_allowed": false,"position": "unknown","tag_format": "iframe","supply_type": "mobile_app","site_id": 853842,"creative_formats_map": "111111111111","creative_formats": ["unknown","html-url","js-url","flash","image","js-raw","html-raw","html-iframe","vast-url","text","xml-url","file-url"],"ad_profile_id": 535543,"visibility_profile_id": 1265,"venue_id": 747342,"pop_max_width": 300,"pop_max_height": 250,"pop_is_prepop": false,"allowed_media_types": [1],"media_subtypes": ["banner"],"estimated_clear_price":0.19000,"estimated_average_price":0.0480,"id":3500613}],"bid_info": {"user_id_64": 8286532254374716388,"no_cookies": false,"payment_rule_id": 483070,"no_flash": true,"user_agent": "WindowsAdClient/8.1.30911.0 (Windows; XAML)","browser": 0,"operating_system_extended": 93,"operating_system_family": 5,"carrier": 1,"device_type": 1,"language": 1,"session_freq": 1,"pub_session_freq": 1,"ip_address": "75.129.210.209","country": "US","region": "MI","city": "Big Rapids","postal_code": "49307","dma": 540,"time_zone": "America/New_York","inventory_class": "unaudited","within_iframe": false,"device_ids": {"windowsadid": "${device_id}"},"selling_member_id":280,"publisher_id":421220,"gender":"female","url":"windows.xbox_apps_windows.games.microsoftadexchange.com","domain":"windows.xbox_apps_windows.games.microsoftadexchange.com","userdata_json":"{}","segments": [{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":24039426}]}}}  
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id": "8765482113786061111","imp": [{"id": "449387476987463500","banner": {"w": 320,"h": 50,"id": "1","battr": [1, 2, 15],"pos": 0,"format": [{"w": 320,"h": 50}]},"instl": 0,"tagid": "12347654","secure": 1,"ext": {"appnexus": {"estimated_clear_price": 0.57,"predicted_view_rate": 0.073255,"member_ad_profile_id": 1111055,"predicted_video_completion_rate": 0.592172,"predicted_view_rate_over_total": 0.067229,"allowed_payment_types": [{"payment_type": 1,"imp_count_method": 2}]}}}],"app": {"domain": "example.com","cat": ["IAB12-2", "IAB12", "IAB11-5"],"page": "https://example.com/somepage.html","publisher": {"id": "1111999"}},"device": {"ua": "Mozilla/5.0 (Linux; Android 6.0.1; HUAWEI Build/MMB28B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.137 Mobile Safari/537.36","geo": {"lat": 36.6203,"lon": -4.4998,"country": "US","region": "MA","metro": "1","city": "UnaCuidad","zip": "94110","utcoffset": 60,"ext": {"appnexus": {"timezone": "Africa/Ceuta"}}},"dnt": 0,"ip": "11.222.111.0","devicetype": 3,"ifa": "${device_id}","make": "Unknown","model": "Generic Android Mobile","os": "Android","language": "es","connectiontype": 0},"user": {"id": "7939999668795769876","buyeruid": "CABBBBrbuQ9AA5DMJJJJlOL9ZOo","gender": "O","data": [{"id": "0","segment": [{"id": "1","value": "0"}]}, {"id": "1234","segment": [{"id": "4444555","value": "0"}]}]},"test": 0,"at": 1,"tmax": 150,"wseat": ["1234"],"cur": ["USD"],"bcat": ["IAB23-7", "IAB23-5", "IAB23-10", "IAB23-9", "IAB23-1", "IAB7-44", "IAB9-9", "IAB8-18", "IAB8-5"],"badv": ["url1.com", "url2.com"],"ext": {"appnexus": {"seller_member_id": 123,"spend_protection": true,"publisher_integration": {"is_header": 0,"bid_shading_high": 1,"bid_shading_medium": 0.35,"bid_shading_low": 0.95}}},"source": {"fd": 1,"tid": "2dd111ff-7777-4abc-8558-86a123ab46d6"}}	
     
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}
	   Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=2a87325dd6e0c924a2aa81207c43bc64		#AppNexus: not available
	   Should Match Regexp 			${output}  				55=

Appnexus Microsoft- Logging SITE ID as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-09-17 00:03:39","bidder_timeout_ms":350,"members": [{"id":2049}],"member_ad_profile_id":23349,"tags": [{"auction_id_64": 734363769550,"size": "320x50","sizes" : ["320x50"],"smaller_sizes_allowed": false,"position": "unknown","tag_format": "javascript","supply_type": "mobile_web","site_id": 654321,"ad_profile_id": 499864,"visibility_profile_id": 1,"venue_id": 754708,"pop_max_width": 320,"pop_max_height": 50,"pop_is_prepop": false,"allowed_media_types": [1],"media_subtypes": ["banner"],"estimated_clear_price":6.00000,"estimated_average_price":2.1820}],"bid_info": {"user_id_64": 1134680225941443693,"no_cookies": false,"payment_rule_id": 517345,"no_flash": false,"user_agent": "Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; SAMSUNG-SM-G730A Build/KOT49H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30","browser": 14,"operating_system": 6,"operating_system_extended": 114,"operating_system_family": 2,"carrier": 1,"device_make": 361,"device_model": 12115,"device_type": 2,"language": 1,"accepted_languages": "en-US","session_freq": 5,"pub_session_freq": 5,"ip_address": "75.102.191.229","country": "US","region": "SD","city": "Brookings","postal_code": "57006","dma": 725,"time_zone": "America/Chicago","inventory_class": "unaudited","within_iframe": false,"device_ids": {"aaid": "${device_id}"},"selling_member_id":280,"url":"us.msn.com","domain":"us.msn.com","inventory_audits": [{"auditor_member_id": null,"intended_audience":"general","inventory_attributes": []}],"userdata_json":"{}","segments": [{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23491755}]}}}  
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable	 ${data}		  {"id": "8765482113786061111","imp": [{"id": "449387476987463501","banner": {"w": 320,"h": 50,"id": "1","battr": [1, 2, 15],"pos": 0,"format": [{"w": 320,"h": 50}]},"instl": 0,"tagid": "12347654","secure": 1,"ext": {"appnexus": {"estimated_clear_price": 0.57,"predicted_view_rate": 0.073255,"member_ad_profile_id": 1111055,"predicted_video_completion_rate": 0.592172,"predicted_view_rate_over_total": 0.067229,"allowed_payment_types": [{"payment_type": 1,"imp_count_method": 2}]}}}],"site": {"id": "${site_id}","domain": "example.com","cat": ["IAB12-2", "IAB12", "IAB11-5"],"page": "https://example.com/somepage.html","publisher": {"id": "1111999"}},"device": {"ua": "Mozilla/5.0 (Linux; Android 6.0.1; HUAWEI Build/MMB28B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.137 Mobile Safari/537.36","geo": {"lat": 36.6203,"lon": -4.4998,"country": "US","region": "MA","metro": "1","city": "UnaCuidad","zip": "94110","utcoffset": 60,"ext": {"appnexus": {"timezone": "Africa/Ceuta"}}},"dnt": 0,"ip": "11.222.111.0","devicetype": 4,"ifa":"${device_id}","make": "Unknown","model": "Generic Android Mobile","os": "Android","language": "es","connectiontype": 0},"user": {"id": "7939999668795769876","buyeruid": "CABBBBrbuQ9AA5DMJJJJlOL9ZOo","gender": "O","data": [{"id": "0","segment": [{"id": "1","value": "0"}]}, {"id": "1234","segment": [{"id": "4444555","value": "0"}]}]},"test": 0,"at": 1,"tmax": 150,"wseat": ["1234"],"cur": ["USD"],"bcat": ["IAB23-7", "IAB23-5", "IAB23-10", "IAB23-9", "IAB23-1", "IAB7-44", "IAB9-9", "IAB8-18", "IAB8-5"],"badv": ["url1.com", "url2.com"],"ext": {"appnexus": {"seller_member_id": 123,"spend_protection": true,"publisher_integration": {"is_header": 0,"bid_shading_high": 1,"bid_shading_medium": 0.35,"bid_shading_low": 0.95}}},"source": {"fd": 1,"tid": "2dd111ff-7777-4abc-8558-86a123ab46d6"}}	
   
	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=
	   Should Match Regexp 			${output}  				55=${site_id}  
	   
Appnexus Microsoft- Logging SITE (exchange:not available) as ID
	   ${device_id}=		Generate Clear Device ID
	   Run Keyword Unless		'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"bid_request":{"timestamp":"2015-09-17 00:03:39","bidder_timeout_ms":350,"members": [{"id":2049}],"member_ad_profile_id":23349,"tags": [{"auction_id_64": 734363769550,"size": "320x50","sizes" : ["320x50"],"smaller_sizes_allowed": false,"position": "unknown","tag_format": "javascript","supply_type": "mobile_web","ad_profile_id": 499864,"visibility_profile_id": 1,"venue_id": 754708,"pop_max_width": 320,"pop_max_height": 50,"pop_is_prepop": false,"allowed_media_types": [1],"media_subtypes": ["banner"],"estimated_clear_price":6.00000,"estimated_average_price":2.1820}],"bid_info": {"user_id_64": 1134680225941443693,"no_cookies": false,"payment_rule_id": 517345,"no_flash": false,"user_agent": "Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; SAMSUNG-SM-G730A Build/KOT49H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30","browser": 14,"operating_system": 6,"operating_system_extended": 114,"operating_system_family": 2,"carrier": 1,"device_make": 361,"device_model": 12115,"device_type": 2,"language": 1,"accepted_languages": "en-US","session_freq": 5,"pub_session_freq": 5,"ip_address": "75.102.191.229","country": "US","region": "SD","city": "Brookings","postal_code": "57006","dma": 725,"time_zone": "America/Chicago","inventory_class": "unaudited","within_iframe": false,"device_ids": {"aaid": "${device_id}"},"selling_member_id":280,"url":"us.msn.com","domain":"us.msn.com","inventory_audits": [{"auditor_member_id": null,"intended_audience":"general","inventory_attributes": []}],"userdata_json":"{}","segments": [{"id":1,"member_id":0,"code":"cookie_birthday","provider":"Appnexus","last_seen_min":23491755}]}}}  
	   Run Keyword If			'${APPNEXUS_FLAG}'=='RTB'			Set Test Variable    ${data}   		  {"id": "8765482113786061111","imp": [{"id": "449387476987463501","banner": {"w": 320,"h": 50,"id": "1","battr": [1, 2, 15],"pos": 0,"format": [{"w": 320,"h": 50}]},"instl": 0,"tagid": "12347654","secure": 1,"ext": {"appnexus": {"estimated_clear_price": 0.57,"predicted_view_rate": 0.073255,"member_ad_profile_id": 1111055,"predicted_video_completion_rate": 0.592172,"predicted_view_rate_over_total": 0.067229,"allowed_payment_types": [{"payment_type": 1,"imp_count_method": 2}]}}}],"site": {"domain": "example.com","cat": ["IAB12-2", "IAB12", "IAB11-5"],"page": "https://example.com/somepage.html","publisher": {"id": "1111999"}},"device": {"ua": "Mozilla/5.0 (Linux; Android 6.0.1; HUAWEI Build/MMB28B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.137 Mobile Safari/537.36","geo": {"lat": 36.6203,"lon": -4.4998,"country": "US","region": "MA","metro": "1","city": "UnaCuidad","zip": "94110","utcoffset": 60,"ext": {"appnexus": {"timezone": "Africa/Ceuta"}}},"dnt": 0,"ip": "11.222.111.0","devicetype": 4,"ifa":"${device_id}","make": "Unknown","model": "Generic Android Mobile","os": "Android","language": "es","connectiontype": 0},"user": {"id": "7939999668795769876","buyeruid": "CABBBBrbuQ9AA5DMJJJJlOL9ZOo","gender": "O","data": [{"id": "0","segment": [{"id": "1","value": "0"}]}, {"id": "1234","segment": [{"id": "4444555","value": "0"}]}]},"test": 0,"at": 1,"tmax": 150,"wseat": ["1234"],"cur": ["USD"],"bcat": ["IAB23-7", "IAB23-5", "IAB23-10", "IAB23-9", "IAB23-1", "IAB7-44", "IAB9-9", "IAB8-18", "IAB8-5"],"badv": ["url1.com", "url2.com"],"ext": {"appnexus": {"seller_member_id": 123,"spend_protection": true,"publisher_integration": {"is_header": 0,"bid_shading_high": 1,"bid_shading_medium": 0.35,"bid_shading_low": 0.95}}},"source": {"fd": 1,"tid": "2dd111ff-7777-4abc-8558-86a123ab46d6"}}	
   		
   	   RTB Appnexus Request             ${RTB_APPNEXUS_API}        ${data}   
       Start Read Requests Logs For Consumer Id			consumer_id=${device_id}	
	   Should Match Regexp 			${output}  				54=
	   Should Match Regexp 			${output}  				55=2a87325dd6e0c924a2aa81207c43bc64 		   